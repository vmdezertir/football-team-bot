import { Injectable, Logger } from '@nestjs/common';
import { Context, Markup } from 'telegraf';
import { ECommands } from '@app/enums';
import { UserRepository } from '@app/repositories';
@Injectable()
export class TelegramStartService {
  private readonly logger = new Logger(TelegramStartService.name);

  constructor(private readonly userRepository: UserRepository) {}

  async start(ctx: Context): Promise<void> {
    const message = ctx.message;
    if (!message) {
      return;
    }

    this.logger.log('New user enter', message?.from);

    const commonMenu = [
      [Markup.button.callback('ü§î –í–∫–∞–∑–∞—Ç–∏ –∫–æ–º–∞–Ω–¥—É', ECommands.ADD_TEAM)],
      [Markup.button.callback('ü´∂üèº –£–ª—é–±–ª–µ–Ω—ñ', ECommands.SEE_FAVORITES)],
      [Markup.button.callback('üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–∏', ECommands.RESTART)],
    ];

    const { id, first_name, last_name, username, language_code } = message.from;
    try {
      await this.userRepository.insert({
        telegramId: id,
        name: `${first_name}${last_name ? ' ' + last_name : ''}`,
        userName: username,
        language: language_code,
      });
    } catch (err) {
      this.logger.log('–ü–æ–≤—Ç–æ—Ä–Ω–∏–π –≤—Ö—ñ–¥');
      await ctx.replyWithHTML(
        `<b>–í—ñ—Ç–∞—î–º–æ –∑ –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è–º –Ω–∞ –ø–æ–ª–µ!</b>\n–ì–æ—Ç–æ–≤–∏–π –¥–æ –Ω–æ–≤–æ–≥–æ –º–∞—Ç—á—É? –Ø–∫—â–æ –ø–æ—Ç—Ä—ñ–±–Ω–∞ –ø–æ—Ä–∞–¥–∞ —á–∏ –ø—ñ–¥—Ç—Ä–∏–º–∫–∞, –ø—Ä–æ—Å—Ç–æ –ø—ñ–¥–±–∏–π –º º—è—á–∞ —Ç–∞ –∑–∞–ø–∏—Ç–∞–π. –î–∞–≤–∞–π—Ç–µ —Ä—É—Ö–∞—Ç–∏—Å—è –¥–æ –ø–µ—Ä–µ–º–æ–≥–∏ —Ä–∞–∑–æ–º! üëá`,
        Markup.keyboard(commonMenu),
      );
      return;
    }

    await ctx.replyWithHTML(
      `<b>–í—ñ—Ç–∞—î–º–æ —Ç–µ–±–µ —É —Å–≤—ñ—Ç—ñ —Ñ—É—Ç–±–æ–ª—å–Ω–∏—Ö –µ–º–æ—Ü—ñ–π, –Ω–æ–≤–∏–π –¥—Ä—É–∂–µ! üëã</b>
            \n‚öΩ –¢–∏ –∫—Ä–æ–∫–Ω—É–≤ —É –∑–∞—Ö–æ–ø–ª—é—é—á–∏–π —Å–≤—ñ—Ç –Ω–∞—à–æ–≥–æ —Ç–µ–ª–µ–≥—Ä–∞–º –±–æ—Ç—É, –¥–µ –∫–æ–∂–µ–Ω –º–∞—Ç—á, –∫–æ–∂–µ–Ω –≥–æ–ª —ñ –∫–æ–∂–µ–Ω –ø–µ—Ä–µ–º–æ–∂–Ω–∏–π –º–æ–º–µ–Ω—Ç —Å—Ç–∞—é—Ç—å —á–∞—Å—Ç–∏–Ω–æ—é —Ç–≤–æ—î—ó —Ñ—É—Ç–±–æ–ª—å–Ω–æ—ó –ø—Ä–∏–≥–æ–¥–∏.
            \n<b>–î–æ—Å—Ç—É–ø–Ω–∏–π —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª –±–æ—Ç–∞:</b>
            \n1. <b>–î–æ–¥–∞–≤–∞–Ω–Ω—è —É–ª—é–±–ª–µ–Ω–∏—Ö –∫–æ–º–∞–Ω–¥:</b> –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –º–æ–∂–µ –¥–æ–¥–∞–≤–∞—Ç–∏ —Å–≤–æ—ó —É–ª—é–±–ª–µ–Ω—ñ —Ñ—É—Ç–±–æ–ª—å–Ω—ñ –∫–æ–º–∞–Ω–¥–∏ –¥–æ —Å–ø–∏—Å–∫—É –æ–±—Ä–∞–Ω–æ–≥–æ. –¶–µ –¥–∞—î –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å –æ—Ç—Ä–∏–º—É–≤–∞—Ç–∏ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –ø—Ä–æ –Ω–∏—Ö —Ç–∞ –¥–æ—Å—Ç—É–ø –¥–æ —ñ–Ω—à–∏—Ö —Ñ—É–Ω–∫—Ü—ñ–π, –ø–æ–≤'—è–∑–∞–Ω–∏—Ö –∑ —Ü–∏–º–∏ –∫–æ–º–∞–Ω–¥–∞–º–∏.
            \n2. <b>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —É–ª—é–±–ª–µ–Ω–∏–º –∫–æ–º–∞–Ω–¥–∞–º:</b> –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –º–æ–∂–µ –ø–µ—Ä–µ–≥–ª—è–¥–∞—Ç–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–Ω—ñ –¥–∞–Ω—ñ –ø—Ä–æ —Å–≤–æ—ó —É–ª—é–±–ª–µ–Ω—ñ –∫–æ–º–∞–Ω–¥–∏, —Ç–∞–∫—ñ —è–∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏, –≥–æ–ª–∏, –∂–æ–≤—Ç—ñ —Ç–∞ —á–µ—Ä–≤–æ–Ω—ñ –∫–∞—Ä—Ç–∫–∏ —Ç–æ—â–æ.
            \n3. <b>–ü—Ä–æ–≥–Ω–æ–∑–∏ –Ω–∞ –º–∞–π–±—É—Ç–Ω—ñ –º–∞—Ç—á—ñ:</b> –ë–æ—Ç –Ω–∞–¥–∞—î –ø—Ä–æ–≥–Ω–æ–∑–∏ –Ω–∞ –º–∞–π–±—É—Ç–Ω—ñ –º–∞—Ç—á—ñ —É–ª—é–±–ª–µ–Ω–∏—Ö –∫–æ–º–∞–Ω–¥, –¥–æ–ø–æ–º–∞–≥–∞—é—á–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º –∑—Ä–æ–±–∏—Ç–∏ –ø—Ä–∏–±–ª–∏–∑–Ω—É –æ—Ü—ñ–Ω–∫—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤.
            \n4. <b>–ú—ñ–Ω—É–ª—ñ —ñ–≥—Ä–∏:</b> –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –º–æ–∂–µ –ø–µ—Ä–µ–≥–ª—è–¥–∞—Ç–∏ —ñ—Å—Ç–æ—Ä—ñ—é –º–∏–Ω—É–ª–∏—Ö –º–∞—Ç—á—ñ–≤ —Å–≤–æ—ó—Ö —É–ª—é–±–ª–µ–Ω–∏—Ö –∫–æ–º–∞–Ω–¥, —Ä–∞–∑–æ–º —ñ–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ —Ç–∞ –æ—Å–Ω–æ–≤–Ω–∏–º–∏ –ø–æ–¥—ñ—è–º–∏ –º–∞—Ç—á—É.
            \n5. <b>–ù–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è –ø—Ä–æ –º–∞–π–±—É—Ç–Ω—ñ –º–∞—Ç—á—ñ:</b> –ë–æ—Ç –Ω–∞–¥—Å–∏–ª–∞—î –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–≤—ñ –Ω–∞–≥–∞–¥—É–≤–∞–Ω–Ω—è –ø—Ä–æ –º–∞–π–±—É—Ç–Ω—ñ –º–∞—Ç—á—ñ –π–æ–≥–æ —É–ª—é–±–ª–µ–Ω–∏—Ö –∫–æ–º–∞–Ω–¥ –∑–∞ –ø–µ–≤–Ω–∏–π –ø–µ—Ä—ñ–æ–¥ —á–∞—Å—É –ø–µ—Ä–µ–¥ –ø–æ—á–∞—Ç–∫–æ–º –º–∞—Ç—á—É.
            \n6. <b>–¢–µ–∫—Å—Ç–æ–≤–∞ —Ç—Ä–∞–Ω—Å–ª—è—Ü—ñ—è –º–∞—Ç—á—ñ–≤:</b> –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –º–æ–∂–µ –ø–µ—Ä–µ–≥–ª—è–¥–∞—Ç–∏ —Ç–µ–∫—Å—Ç–æ–≤—É —Ç—Ä–∞–Ω—Å–ª—è—Ü—ñ—é –º–∞—Ç—á—ñ–≤ —Å–≤–æ—ó—Ö —É–ª—é–±–ª–µ–Ω–∏—Ö –∫–æ–º–∞–Ω–¥, –æ—Ç—Ä–∏–º—É—é—á–∏ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –ø—Ä–æ –ø–æ–¥—ñ—ó –Ω–∞ –ø–æ–ª—ñ –≤ —Ä–µ–∂–∏–º—ñ —Ä–µ–∞–ª—å–Ω–æ–≥–æ —á–∞—Å—É.
            \n\n–Ø–∫—â–æ –≤ —Ç–µ–±–µ –≤–∂–µ —î –¥–æ–¥–∞–Ω—ñ –∫–æ–º–∞–Ω–¥–∏, —Ç–æ —Ç–∏ –º–æ–∂–µ—à –≤–∏–±—Ä–∞—Ç–∏ "ü´∂üèº –£–ª—é–±–ª–µ–Ω—ñ" –∞–±–æ –≤–∫–∞–∑–∞—Ç–∏ –Ω–æ–≤—ñ —Å–∫–æ—Ä–∏—Å—Ç–∞–≤—à–∏—Å—å –ø—É–Ω–∫—Ç–æ–º –º–µ–Ω—é üëá`,
      Markup.keyboard(commonMenu),
    );
  }
}
